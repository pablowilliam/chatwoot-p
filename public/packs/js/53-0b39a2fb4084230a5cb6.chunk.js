(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{1594:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var n=[{key:"assign_team",label:"Assign a team",inputType:"search_select"},{key:"assign_agent",label:"Assign an agent",inputType:"search_select"},{key:"add_label",label:"Add a label",inputType:"multi_select"},{key:"remove_label",label:"Remove a label",inputType:"multi_select"},{key:"remove_assigned_team",label:"Remove Assigned Team",inputType:null},{key:"send_email_transcript",label:"Send an email transcript",inputType:"email"},{key:"mute_conversation",label:"Mute conversation",inputType:null},{key:"snooze_conversation",label:"Snooze conversation",inputType:null},{key:"resolve_conversation",label:"Resolve conversation",inputType:null},{key:"send_webhook_event",label:"Send Webhook Event",inputType:"url"},{key:"send_attachment",label:"Send Attachment",inputType:"attachment"},{key:"send_message",label:"Send a message",inputType:"textarea"},{key:"add_private_note",label:"Add a private note",inputType:"textarea"},{key:"change_priority",label:"Change Priority",inputType:"search_select"}]},1609:function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"e",(function(){return o})),r.d(e,"d",(function(){return i})),r.d(e,"c",(function(){return s})),r.d(e,"a",(function(){return c}));r(140),r(255),r(81),r(44),r(9),r(141);var n=r(1594),a=function(t){return n.a.find((function(e){return e.key===t})).label},o=function(t,e){return e.map((function(e){var r=t.find((function(t){return t.id===e}));return r?r.name:""})).join(", ")},i=function(t,e){return e.map((function(e){var r=t.find((function(t){return t.title===e}));return r?r.title:""})).join(", ")},s=function(t,e){return e.map((function(e){var r=t.find((function(t){return t.id===e}));return r?r.name:""})).join(", ")},c=function(t,e,r){if(!t||!r)return"";if("send_attachment"===e){var n=r.find((function(e){return e.blob_id===t}));if(n)return n.filename.toString()}return""}},1815:function(t,e,r){},1816:function(t,e,r){},1817:function(t,e,r){},2051:function(t,e,r){"use strict";r(1815)},2052:function(t,e,r){"use strict";r(1816)},2053:function(t,e,r){"use strict";r(1817)},2211:function(t,e,r){"use strict";r.r(e);r(33),r(81),r(140),r(21),r(75),r(91),r(10),r(32),r(9),r(34),r(14),r(17),r(20),r(65),r(59),r(44),r(24),r(29),r(23),r(30),r(22);var n=r(5),a=r(376),o=r(356),i=r(197),s=(r(729),r(319),r(381),r(1590)),c=r.n(s),l=(r(41),r(1775));function u(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return d(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var m=function(){var t=Object(i.c)(),e=Object(n.computed)((function(){return t["labels/getLabels"].value})),r=Object(n.computed)((function(){return t["teams/getTeams"].value})),a=Object(n.computed)((function(){return t["agents/getAgents"].value}));return{getMacroDropdownValues:function(t){switch(t){case"assign_team":case"send_email_to_team":return r.value;case"assign_agent":return[{id:"self",name:"Self"}].concat(u(a.value));case"add_label":case"remove_label":return e.value.map((function(t){return{id:t.title,name:t.title}}));case"change_priority":return l.f;default:return[]}}}},f=r(1747),p={__name:"MacroNode",props:{singleNode:{type:Boolean,default:!1},value:{type:Object,default:function(){return{}}},errorKey:{type:String,default:""},fileName:{type:String,default:""}},emits:["input","resetAction","deleteNode"],setup:function(t,e){var r=e.emit,a=t,i=Object(o.a)().t,s=Object(n.inject)("macroActionTypes"),c=m().getMacroDropdownValues,l=Object(n.computed)({get:function(){return a.value},set:function(t){return r("input",t)}}),u=Object(n.computed)((function(){return a.errorKey?i("MACROS.ERRORS.".concat(a.errorKey)):""})),d=Object(n.computed)((function(){return"send_email_to_team"!==l.value.action_name&&"send_message"!==l.value.action_name&&!!s.find((function(t){return t.key===l.value.action_name})).inputType}));return{__sfc:!0,props:a,emit:r,t:i,macroActionTypes:s,getMacroDropdownValues:c,actionData:l,errorMessage:u,showActionInput:d,dropdownValues:function(){return c(a.value.action_name)},ActionInput:f.a}}},b=r(8),v=Object(b.a)(p,(function(){var t=this,e=t._self._c,r=t._self._setupProxy;return e("div",{staticClass:"relative flex items-center w-full min-w-0 basis-full"},[t.singleNode?t._e():e("woot-button",{staticClass:"absolute cursor-move -left-8 macros__node-drag-handle",attrs:{size:"small",variant:"clear","color-scheme":"secondary",icon:"navigation"}}),t._v(" "),e("div",{staticClass:"flex-grow p-2 mr-2 rounded-md shadow-sm",class:t.errorKey?"bg-red-50 animate-shake dark:bg-red-800":"bg-white dark:bg-slate-700"},[e(r.ActionInput,{attrs:{"action-types":r.macroActionTypes,"dropdown-values":r.dropdownValues(),"show-action-input":r.showActionInput,"show-remove-button":!1,"is-macro":"","error-message":r.errorMessage,"initial-file-name":t.fileName},on:{resetAction:function(e){return t.$emit("resetAction")}},model:{value:r.actionData,callback:function(t){r.actionData=t},expression:"actionData"}})],1),t._v(" "),t.singleNode?t._e():e("woot-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("MACROS.EDITOR.DELETE_BTN_TOOLTIP"),expression:"$t('MACROS.EDITOR.DELETE_BTN_TOOLTIP')"}],attrs:{icon:"delete",size:"small",variant:"smooth","color-scheme":"alert"},on:{click:function(e){return t.$emit("deleteNode")}}})],1)}),[],!1,null,null,null).exports,_=r(1609),y={components:{Draggable:c.a,MacroNode:v},props:{errors:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}},files:{type:Array,default:function(){return[]}}},computed:{actionData:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{fileName:function(){return _.a.apply(void 0,arguments)}}},h=y,g=(r(2051),Object(b.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"macros__nodes"},[e("div",{staticClass:"macro__node"},[e("div",[e("woot-label",{attrs:{title:t.$t("MACROS.EDITOR.START_FLOW"),"color-scheme":"primary"}})],1)]),t._v(" "),e("Draggable",{staticClass:"macros__nodes-draggable",attrs:{list:t.actionData,animation:"200","ghost-class":"ghost",tag:"div",handle:".macros__node-drag-handle"}},t._l(t.actionData,(function(r,n){return e("div",{key:n,staticClass:"macro__node"},[e("MacroNode",{staticClass:"macros__node-action",attrs:{type:"add",index:n,"error-key":t.errors[`action_${n}`],"file-name":t.fileName(t.actionData[n].action_params[0],t.actionData[n].action_name,t.files),"single-node":1===t.actionData.length},on:{resetAction:function(e){return t.$emit("resetAction",n)},deleteNode:function(e){return t.$emit("deleteNode",n)}},model:{value:t.actionData[n],callback:function(e){t.$set(t.actionData,n,e)},expression:"actionData[i]"}})],1)})),0),t._v(" "),e("div",{staticClass:"macro__node"},[e("div",[e("woot-button",{staticClass:"macros__action-button",attrs:{title:t.$t("MACROS.EDITOR.ADD_BTN_TOOLTIP"),"color-scheme":"success",variant:"smooth",icon:"add-circle"},on:{click:function(e){return t.$emit("addNewNode")}}},[t._v("\n        "+t._s(t.$t("MACROS.EDITOR.ADD_BTN_TOOLTIP"))+"\n      ")])],1)]),t._v(" "),e("div",{staticClass:"macro__node"},[e("div",[e("woot-label",{attrs:{title:t.$t("MACROS.EDITOR.END_FLOW"),"color-scheme":"primary"}})],1)])],1)}),[],!1,null,"04435765",null).exports),O={inject:["v$"],props:{macroName:{type:String,default:""},macroVisibility:{type:String,default:"global"}},methods:{isActive:function(t){return this.macroVisibility===t?"bg-woot-25 dark:bg-slate-900 border-woot-200 dark:border-woot-700":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-600"},onUpdateName:function(t){this.$emit("update:name",t)},onUpdateVisibility:function(t){this.$emit("update:visibility",t)}}},A=(r(2052),Object(b.a)(O,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-3 bg-white dark:bg-slate-900 h-[calc(100vh-3.5rem)] flex flex-col border-l border-slate-50 dark:border-slate-800/50"},[e("div",[e("woot-input",{class:{error:t.v$.macro.name.$error},attrs:{value:t.macroName,label:t.$t("MACROS.ADD.FORM.NAME.LABEL"),placeholder:t.$t("MACROS.ADD.FORM.NAME.PLACEHOLDER"),error:t.v$.macro.name.$error?t.$t("MACROS.ADD.FORM.NAME.ERROR"):null},on:{input:function(e){return t.onUpdateName(e)}}})],1),t._v(" "),e("div",{staticClass:"mt-2"},[e("p",{staticClass:"block m-0 text-sm font-medium leading-[1.8] text-slate-700 dark:text-slate-100"},[t._v("\n      "+t._s(t.$t("MACROS.EDITOR.VISIBILITY.LABEL"))+"\n    ")]),t._v(" "),e("div",{staticClass:"grid grid-cols-1 lg:grid-cols-2 gap-3"},[e("button",{staticClass:"p-2 relative rounded-md border border-solid text-left cursor-default",class:t.isActive("global"),on:{click:function(e){return t.onUpdateVisibility("global")}}},["global"===t.macroVisibility?e("fluent-icon",{staticClass:"absolute text-woot-500 dark:text-woot-500 top-2 right-2",attrs:{icon:"checkmark-circle",type:"solid"}}):t._e(),t._v(" "),e("p",{staticClass:"block m-0 text-sm font-medium leading-[1.8] text-slate-700 dark:text-slate-100"},[t._v("\n          "+t._s(t.$t("MACROS.EDITOR.VISIBILITY.GLOBAL.LABEL"))+"\n        ")]),t._v(" "),e("p",{staticClass:"text-xs text-slate-500 dark:text-slate-200"},[t._v("\n          "+t._s(t.$t("MACROS.EDITOR.VISIBILITY.GLOBAL.DESCRIPTION"))+"\n        ")])],1),t._v(" "),e("button",{staticClass:"p-2 relative rounded-md border border-solid text-left cursor-default",class:t.isActive("personal"),on:{click:function(e){return t.onUpdateVisibility("personal")}}},["personal"===t.macroVisibility?e("fluent-icon",{staticClass:"absolute text-woot-500 dark:text-woot-500 top-2 right-2",attrs:{icon:"checkmark-circle",type:"solid"}}):t._e(),t._v(" "),e("p",{staticClass:"block m-0 text-sm font-medium leading-[1.8] text-slate-700 dark:text-slate-100"},[t._v("\n          "+t._s(t.$t("MACROS.EDITOR.VISIBILITY.PERSONAL.LABEL"))+"\n        ")]),t._v(" "),e("p",{staticClass:"text-xs text-slate-500 dark:text-slate-200"},[t._v("\n          "+t._s(t.$t("MACROS.EDITOR.VISIBILITY.PERSONAL.DESCRIPTION"))+"\n        ")])],1)]),t._v(" "),e("div",{staticClass:"mt-2 flex items-start p-2 bg-slate-50 dark:bg-slate-700 p-2 rounded-md"},[e("fluent-icon",{staticClass:"flex-shrink",attrs:{icon:"info",size:"20"}}),t._v(" "),e("p",{staticClass:"ml-2 rtl:ml-0 rtl:mr-2 mb-0 text-slate-600 dark:text-slate-200"},[t._v("\n        "+t._s(t.$t("MACROS.ORDER_INFO"))+"\n      ")])],1)]),t._v(" "),e("div",{staticClass:"mt-auto w-full"},[e("woot-button",{staticClass:"w-full",attrs:{size:"expanded","color-scheme":"success"},on:{click:function(e){return t.$emit("submit")}}},[t._v("\n      "+t._s(t.$t("MACROS.HEADER_BTN_TXT_SAVE"))+"\n    ")])],1)])}),[],!1,null,"301bd31f",null).exports),w=r(58),S=r(116),T=r(1563);function D(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=t&&("undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==r)return;var n,a,o=[],i=!0,s=!1;try{for(r=r.call(t);!(i=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);i=!0);}catch(c){s=!0,a=c}finally{try{i||null==r.return||r.return()}finally{if(s)throw a}}return o}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return I(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var j={components:{MacroNodes:g,MacroProperties:A},props:{macroData:{type:Object,default:function(){return{}}}},setup:function(){var t=Object(S.a)();return Object(n.provide)("v$",t),{v$:t}},data:function(){return{macro:this.macroData,errors:{}}},computed:{files:function(){return this.macro&&this.macro.files?this.macro.files:[]}},watch:{$route:{handler:function(){this.resetValidation()},immediate:!0},macroData:{handler:function(){this.macro=this.macroData},immediate:!0}},validations:{macro:{name:{required:w.f},visibility:{required:w.f}}},methods:{removeObjectProperty:function(t,e){return Object.fromEntries(Object.entries(t).filter((function(t){return D(t,1)[0]!==e})))},updateName:function(t){this.macro.name=t},updateVisibility:function(t){this.macro.visibility=t},appendNode:function(){this.macro.actions.push({action_name:"assign_team",action_params:[]})},deleteNode:function(t){this.errors=this.removeObjectProperty(this.errors,"action_".concat(t)),this.macro.actions.splice(t,1)},submit:function(){this.errors=Object(T.a)(this.macro.actions),0===Object.keys(this.errors).length&&(this.v$.$touch(),this.v$.$invalid||this.$emit("submit",this.macro))},resetNode:function(t){this.errors=this.removeObjectProperty(this.errors,"action_".concat(t)),this.macro.actions[t].action_params=[]},resetValidation:function(){var t,e;this.errors={},null===(t=this.v$)||void 0===t||null===(e=t.$reset)||void 0===e||e.call(t)}}},C=(r(2053),Object(b.a)(j,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex flex-col md:flex-row h-auto md:h-full w-full"},[e("div",{staticClass:"flex-1 w-full md:w-auto macro-gradient-radial dark:macro-dark-gradient-radial macro-gradient-radial-size h-full max-h-full py-4 px-12 overflow-y-auto"},[e("MacroNodes",{attrs:{files:t.files,errors:t.errors},on:{addNewNode:t.appendNode,deleteNode:t.deleteNode,resetAction:t.resetNode},model:{value:t.macro.actions,callback:function(e){t.$set(t.macro,"actions",e)},expression:"macro.actions"}})],1),t._v(" "),e("div",{staticClass:"w-full md:w-1/3"},[e("MacroProperties",{attrs:{"macro-name":t.macro.name,"macro-visibility":t.macro.visibility},on:{"update:name":t.updateName,"update:visibility":t.updateVisibility,submit:t.submit}})],1)])}),[],!1,null,"ab5eb5f4",null).exports),k=r(1594),R=r(64),x=r(1776);function E(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(l){return void r(l)}s.done?e(c):Promise.resolve(c).then(n,a)}function M(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){E(o,n,a,i,s,"next",t)}function s(t){E(o,n,a,i,s,"throw",t)}i(void 0)}))}}function N(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?N(Object(r),!0).forEach((function(e){L(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function L(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function P(t){return function(t){if(Array.isArray(t))return V(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return V(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var B={__name:"MacroEditor",setup:function(t){var e=Object(i.b)(),r=Object(i.c)(),s=Object(a.a)(),c=Object(a.b)(),l=Object(o.a)().t,u=m().getMacroDropdownValues,d=Object(n.ref)(null),f=Object(n.ref)("CREATE"),p=k.a;Object(n.provide)("macroActionTypes",p);var b=Object(n.computed)((function(){return r["macros/getUIFlags"].value})),v=Object(n.computed)((function(){return s.params.macroId})),_=function(){e.dispatch("agents/get"),e.dispatch("teams/get"),e.dispatch("labels/get")},y=function(t){var e=t.actions.map((function(t){var e=[];if(t.action_params.length){var r=p.find((function(e){return e.key===t.action_name})).inputType;e="multi_select"===r||"search_select"===r?u(t.action_name).filter((function(e){return P(t.action_params).includes(e.id)})):"team_message"===r?{team_ids:u(t.action_name).filter((function(e){return P(t.action_params[0].team_ids).includes(e.id)})),message:t.action_params[0].message}:P(t.action_params)}return $($({},t),{},{action_params:e})}));return $($({},t),{},{actions:e})},h=function(){var t=M(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dispatch("macros/getSingleMacro",v.value);case 2:r=e.getters["macros/getMacro"](v.value),d.value=y(r);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g=function(){f.value="EDIT",h()},O=function(){f.value="CREATE",d.value={name:"",actions:[{action_name:"assign_team",action_params:[]}],visibility:"global"}};Object(n.watch)((function(){return s}),(function(){_(),s.params.macroId?g():O()}),{immediate:!0,deep:!0});var A=function(){var t=M(regeneratorRuntime.mark((function t(r){var n,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="EDIT"===f.value?"macros/update":"macros/create",a="EDIT"===f.value?l("MACROS.EDIT.API.SUCCESS_MESSAGE"):l("MACROS.ADD.API.SUCCESS_MESSAGE"),(o=JSON.parse(JSON.stringify(r))).actions=Object(x.a)(o.actions),t.next=7,e.dispatch(n,o);case 7:Object(R.a)(a),c.push({name:"macros_wrapper"}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),Object(R.a)(l("MACROS.ERROR"));case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}();return{__sfc:!0,store:e,getters:r,route:s,router:c,t:l,getMacroDropdownValues:u,macro:d,mode:f,macroActionTypes:p,uiFlags:b,macroId:v,fetchDropdownData:_,formatMacro:y,manifestMacro:h,fetchMacro:g,initNewMacro:O,saveMacro:A,MacroForm:C}}},F=B,U=Object(b.a)(F,(function(){var t=this,e=t._self._c,r=t._self._setupProxy;return e("div",{staticClass:"flex flex-col flex-1 h-full overflow-auto"},[r.uiFlags.isFetchingItem?e("woot-loading-state",{attrs:{message:r.t("MACROS.EDITOR.LOADING")}}):t._e(),t._v(" "),r.macro&&!r.uiFlags.isFetchingItem?e(r.MacroForm,{attrs:{"macro-data":r.macro},on:{"update:macro-data":function(t){r.macro=t},submit:r.saveMacro}}):t._e()],1)}),[],!1,null,null,null);e.default=U.exports}}]);
//# sourceMappingURL=53-0b39a2fb4084230a5cb6.chunk.js.map